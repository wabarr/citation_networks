{% extends "citation_networks/base.html" %}

{% block script_header %}
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

    <style>
    #citation_network {
        width: 100%;
        height: 600px;
        border: 2px solid lightgray;
    }
    </style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <div class="card-title"><h4>{{ object }}</h4></div>
                <p>{% for authorship in object.authorship_set.all %} {{ authorship.author.name }}, {% endfor %}{{ object.year }}. {{ object.title }}. <i>{{ object.journal_name }}</i>. {{ object.volume }}:{{ object.pages }}</p>
            </div>
        </div>
        </div>
    </div>
    {% if object.citations_last_queried == None %}
        <div class="row" id="never-queried-row">
        <h4>Never queried</h4>
            <p>This paper was imported as a citation or a reference to another paper. We don't know anything about its citations or references.</a></p>
            <form action="/import-citations/" method="post">
            {% csrf_token %}
            {{ form }}
            <input type="submit" value="Get Citations and References for {{ object }}">
            </form>
    </div>
        </div>


    {% else %}

        <div class="row">
            <div class="col-lg-12">
                <div class="card" id="citation_network">
                </div>
            </div>
        </div>
    <div class="row">
        <div class="col-lg-12">
            <h4>{{ object.cited_by.all | length }} citations, last queried {{ object.citations_last_queried }}</h4>
        </div>
    </div>
    <div class="row">
            {% for citation in object.cited_by.all %}

             <div class="col-lg-4">
                <div class="card">
                <div class="card-body">
                    <div class="card-title"><a href="{%  url 'paper-detail' citation.id %}">{{ citation }}</a></div>
                </div>
                </div>
            </div>
            {% if forloop.counter|divisibleby:3 %}
                </div><div class="row">
            {% endif %}
            {% endfor %}
    </div>
<div class="row">
    <div class="col-lg-12">
        <h4>{{ object }} cites {{ object.references.all | length }} papers</h4>
    </div>
</div>

    <div class="row">
            {% for reference in object.references.all %}
             <div class="col-lg-4">
                <div class="card">
                <div class="card-body">
                    <div class="card-title"><a href="{%  url 'paper-detail' reference.id %}">{{ reference }}</a></div>
                </div>
                </div>
            </div>
            {% if forloop.counter|divisibleby:3 %}
                </div><div class="row">
            {% endif %}
            {% endfor %}
    </div>
</div>
    {% endif %}
</div>

{% endblock %}

{% block custom_script %}
    <script>
    $("#id_ssid").hide();
    $(".helptext").hide();
    $("label").hide();



    // create a network
    var container = document.getElementById('citation_network');
    var json = $.getJSON("/network-json/{{ object.id }}").done(function(data) {
            var theData = {
                nodes: data.nodes,
                edges: data.links
            };
            var options = {
            layout:{
                improvedLayout: false
                },
            nodes : {
                shape: 'ellipse',
                size: 10
            },
            interaction: {
                navigationButtons: true,
                keyboard: false,
                zoomView: false,
                dragView: false
            },
            physics: {
                enabled: true,
                stabilization: true,
                timestep: 0.3
            },
            edges: {
                arrows: {
                    to: {enabled: true, scaleFactor: 0.75, type: 'arrow'},
                    middle: {enabled: false, scaleFactor: 1, type: 'arrow'},
                    from: {enabled: true, scaleFactor: 0.3, type: 'arrow'}
                }
            }
        };

    // initialize your network!
    var network = new vis.Network(container, theData, options);


        });


    </script>

{% endblock %}

